# 04. Secure Database

See security options for SQL Database

## Architecture

## Use AAD User to Manage DB

## Create a user

Create a user with reader role

## Connect to SQL DB

### SQL Firewall 

## Dynamic Data Masking

```sql
USE master;
GO

CREATE LOGIN webuser 
WITH PASSWORD = N'1q2w3e4R5t^Y'
GO

USE WideWorldImporters;
GO

CREATE USER webuser FOR LOGIN webuser;
GO

CREATE USER Website FOR LOGIN Website;
GO

ALTER ROLE [Great Lakes Sales] ADD MEMBER webuser;
GO

GRANT SELECT, UPDATE ON Sales.Customers TO [Great Lakes Sales];
GO

SELECT * FROM Sales.Customers; 
GO

-- impersonate the user webuser
EXECUTE AS USER = 'webuser';
GO

-- Enable Dynamic Masking for Sales.Customer.PhoneNumber
SELECT * FROM Sales.Customers; 
GO

REVERT;
GO

```

## Advanced Threat Protection

## Discovery and Assessment 

## Activity Monitoring

## Resource Monitoring

### Azure Portal

### SQL DB DMV (Dynamic Management View)

master.sys.resource_stats

userdb.sys.dm_db_resource_stats

